---

        - name: " ==docker distribution"
          yum:
           name: [ python, firewalld, docker-distribution,python2-passlib, py-bcrypt]
           state: present

        - name: "create privatekey"
          openssl_privatekey:
           path: /etc/pki/tls/private/registryy.key
           size: 4096

        - name: "create " 
          openssl_csr:
           path: /etc/pki/tls/registryy.csr 
           privatekey_path: /etc/pki/tls/private/registryy.key
           country_name: BE
           organization_name: stage
           common_name: "{{common_name_registry}}"       

        - name: " create selfsigned CA "
          openssl_certificate:
           provider: selfsigned
           privatekey_path: /etc/pki/tls/private/registryy.key
           path: /etc/pki/tls/registryy.crt
           csr_path: /etc/pki/tls/registryy.csr 
       
        - name: " create auth"
          htpasswd:
           path: /etc/docker-distribution/dockerpasswd
           create: yes
           state: present
           name: "dock"
           password: "{{passwd}}"
           crypt_scheme: bcrypt

        - name: "modi conf"
          copy:
           src: /home/rayane/stage/config.yml
           dest: /etc/docker-distribution/registry/config.yml

#        - name: "auth"
#          shell: htpasswd -c -b -B /etc/docker-distribution/dockerpasswd dock rayane1997

        - name: "set firewall"
          firewalld:
           port: 5000/tcp
           permanent: true
           state: enabled
